---
title: "Random Paper Sampling"
author: "Alicia Halhed"
date: "28/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Script set up
Attach the packages required and set working directory. These chunks need to be run every time.

```{r packages}
# run every time
# load required packages
library(litsearchr)
#install.packages("revtools")
library(revtools)
#install.packages("plyr")
library(plyr)
library(tidyverse)
# set working directory to file location
setwd("~/University/University 2020-2021/thesis/MicrobiomeThesis")
```

```{r subset0b}
importRisely <- import_results(file = "ReferencesRisely.ris", verbose = TRUE)
# read the initial .RIS data into R
import <- import_results(file = "ReferencesCompiled01.txt", verbose = TRUE) %>%
  # join compiled references from R with Risely papers
  full_join(importRisely)
```

## Note on running below code
For creating a subset, the chunk labeled 'a' gets run after all chunks labeled 'b' before it have been run. This generates an output file with the desired number of articles. To generate the list of articles not used yet, run all chunks labeled 'b'.

### Subset 1

```{r subset1a}
# not re-run when creating next subset
# randomly select articles (can change number)
set <- import[sample(nrow(import), 5),]
# writing file called download1 to BibChunks folder (could use better names)
# writing to bib to ensure all info is captured (even columns with NA)
write_bibliography(set, "BibChunks/download1.bib", format = "bib") 
# now we have a random subset of the articles to work with
# in a bibtex file that can be loaded into Mendeley
```

```{r subset1b}
# this is re-run for every new subset
# this object should have 5 fewer articles than the previous import
importSub <- import_results(file = "BibChunks/download1.bib", verbose = TRUE) %>%
  # additional files for import go here, like for initial import above
  # make sure NA's are NA's not strings (reads bib format funny)
  mutate_all(~ replace(., .=='NA', NA)) %>%
  # remove the articles already assessed from the original download
  # sorting by title only to streamline the anti_join
  anti_join(import, ., by = "title")
# this is the list of articles the next subset is made from
```

```{r subset1c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download1.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
```


### Subset 2

```{r subset2a}
# not re-run when creating next subset
set <- importSub[sample(nrow(importSub), 5),]
write_bibliography(set, "BibChunks/download2.bib", format = "bib") 
```

```{r subset2b}
# this is re-run for every new subset
# replace #'s with subset number
importSub2 <- import_results(file = "BibChunks/download2.bib", verbose = TRUE) %>%
  mutate_all(~ replace(., .=='NA', NA)) %>%
  anti_join(importSub, ., by = "title") # add previous subset number
```

```{r subset2c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download2.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
```

### Subset 3

```{r subset3a}
# not re-run when creating next subset
set <- importSub2[sample(nrow(importSub2), 5),]
write_bibliography(set, "BibChunks/download3.bib", format = "bib") 
```

```{r subset3b}
# this is re-run for every new subset
# replace #'s with subset number
importSub3 <- import_results(file = "BibChunks/download3.bib", verbose = TRUE) %>%
  mutate_all(~ replace(., .=='NA', NA)) %>%
  anti_join(importSub2, ., by = "title") # add previous subset number
```

```{r subset3c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download3.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
```

### Subset 4

```{r subset4a}
# not re-run when creating next subset
set <- importSub3[sample(nrow(importSub3), 5),]
write_bibliography(set, "BibChunks/download4.bib", format = "bib") 
```

```{r subset4b}
# this is re-run for every new subset
# replace #'s with subset number
importSub4 <- import_results (file = "BibChunks/download4.bib", verbose = TRUE) %>%
  mutate_all(~ replace(., .=='NA', NA)) %>%
  anti_join(importSub3, ., by = "title") # add previous subset number
```

```{r subset4c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download4.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
```

### Subset 5

```{r subset5a}
# not re-run when creating next subset
set <- importSub4[sample(nrow(importSub4), 5),]
write_bibliography(set, "BibChunks/download5.bib", format = "bib") 
```

```{r subset5b}
# this is re-run for every new subset
# replace #'s with subset number
importSub5 <- import_results (file = "BibChunks/download5.bib", verbose = TRUE) %>%
  mutate_all(~ replace(., .=='NA', NA)) %>%
  anti_join(importSub4, ., by = "title") # add previous subset number
```

```{r subset5c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download5.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
#Note that in this subset, Rottjers IS a Risely reference. The accents on this name prevented the code from identifying this.
```

### Subset 6

```{r subset6a}
# not re-run when creating next subset
set <- importSub5[sample(nrow(importSub5), 5),]
write_bibliography(set, "BibChunks/download6.bib", format = "bib") 
```

```{r subset6b}
# this is re-run for every new subset
# replace #'s with subset number
importSub6 <- import_results (file = "BibChunks/download6.bib", verbose = TRUE) %>%
  mutate_all(~ replace(., .=='NA', NA)) %>%
  anti_join(importSub5, ., by = "title") # add previous subset number
```

```{r subset6c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download6.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
```

### Subset 7

```{r subset7a}
# not re-run when creating next subset
set <- importSub6[sample(nrow(importSub6), 5),]
write_bibliography(set, "BibChunks/download7.bib", format = "bib") 
```

```{r subset7b}
# this is re-run for every new subset
# replace #'s with subset number
importSub7 <- import_results (file = "BibChunks/download7.bib", verbose = TRUE) %>%
  mutate_all(~ replace(., .=='NA', NA)) %>%
  anti_join(importSub6, ., by = "title") # add previous subset number
```

```{r subset7c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download7.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
```

### Subset 8

```{r subset8a}
# not re-run when creating next subset
set <- importSub7[sample(nrow(importSub7), 5),]
write_bibliography(set, "BibChunks/download8.bib", format = "bib") 
```

```{r subset8b}
# this is re-run for every new subset
# replace #'s with subset number
importSub8 <- import_results (file = "BibChunks/download8.bib", verbose = TRUE) %>%
  mutate_all(~ replace(., .=='NA', NA)) %>%
  anti_join(importSub7, ., by = "title") # add previous subset number
```

```{r subset8c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download8.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
#it also did not pick up Thomas, which is a Risely reference
```

### Subset 9

```{r subset9a}
# not re-run when creating next subset
set <- importSub8[sample(nrow(importSub8), 5),]
write_bibliography(set, "BibChunks/download9.bib", format = "bib") 
```

```{r subset9b}
# this is re-run for every new subset
# replace #'s with subset number
importSub9 <- import_results (file = "BibChunks/download9.bib", verbose = TRUE) %>%
  mutate_all(~ replace(., .=='NA', NA)) %>%
  anti_join(importSub8, ., by = "title") # add previous subset number
```

```{r subset9c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download9.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
```

### Subset 10

```{r subset10a}
# not re-run when creating next subset
set <- importSub9[sample(nrow(importSub9), 5),]
write_bibliography(set, "BibChunks/download10.bib", format = "bib") 
```

```{r subset10b}
# this is re-run for every new subset
# replace #'s with subset number
importSub10 <- import_results (file = "BibChunks/download10.bib", verbose = TRUE) %>%
  mutate_all(~ replace(., .=='NA', NA)) %>%
  anti_join(importSub9, ., by = "title") # add previous subset number
```

```{r subset10c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download10.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
```

### Subset 11

```{r subset11a}
# not re-run when creating next subset
set <- importSub10[sample(nrow(importSub10), 5),]
write_bibliography(set, "BibChunks/download11.bib", format = "bib") 
```

```{r subset11b}
# this is re-run for every new subset
# replace #'s with subset number
importSub11 <- import_results (file = "BibChunks/download11.bib", verbose = TRUE) %>%
  mutate_all(~ replace(., .=='NA', NA)) %>%
  anti_join(importSub10, ., by = "title") # add previous subset number
```

```{r subset11c}
#Identifying papers that are NOT shared by Risely and the subset
import_results(file = "BibChunks/download11.bib", verbose = TRUE) %>% anti_join(importRisely) %>%
  select(author, title)
```


### Downloading each subset into R
### Rerun for each subset

```{r subset1}
download1.bib <- import_results(file = "BibChunks/download1.bib", verbose = TRUE)
View(download1.bib)
```

```{r subset2}
download2.bib <- import_results(file = "BibChunks/download2.bib", verbose = TRUE)
View(download2.bib)
```

```{r subset3}
download3.bib <- import_results(file = "BibChunks/download3.bib", verbose = TRUE)
View(download3.bib)
```

```{r subset4}
download4.bib <- import_results(file = "BibChunks/download4.bib", verbose = TRUE)
View(download4.bib)
```

```{r subset5}
download5.bib <- import_results(file = "BibChunks/download5.bib", verbose = TRUE)
View(download5.bib)
```

```{r subset6}
download6.bib <- import_results(file = "BibChunks/download6.bib", verbose = TRUE)
View(download6.bib)
```

```{r subset7}
download7.bib <- import_results(file = "BibChunks/download7.bib", verbose = TRUE)
View(download7.bib)
```

```{r subset8}
download8.bib <- import_results(file = "BibChunks/download8.bib", verbose = TRUE)
View(download8.bib)
```

```{r subset9}
download9.bib <- import_results(file = "BibChunks/download9.bib", verbose = TRUE)
View(download9.bib)
```

```{r subset10}
download10.bib <- import_results(file = "BibChunks/download10.bib", verbose = TRUE)
View(download10.bib)
```



